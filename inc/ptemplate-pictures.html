<?php
	$current_article = safe_row('*', 'textpattern', "url_title = '".$GLOBALS['current_category']."'");
	
    $small_images	= explode(',',$current_article['custom_1']);
    $big_images		= explode(',',$current_article['custom_2']);
    $large_images	= explode(',',$current_article['Image']);
    
	global $imgdir;
      
	echo "<script>";
	echo "var images_gallery = true;";
      
    $big_images_array = safe_rows('*', 'txp_image', "`id` IN (".$current_article['custom_2'].")");
    $large_images_array = safe_rows('*', 'txp_image', "`id` IN (".$current_article['Image'].")");
    
    $new_big_images_array = array();
    $new_large_images_array = array();
    
    for ($x=0; $x<count($big_images);$x++) {
        foreach ($big_images_array as $single_big_image) {
        	if ($single_big_image['id'] == $big_images[$x]) {
	            $new_big_images_array[] = $single_big_image;
            	break;
            }
        }

        echo 'screenshots_data['.$x.'] = {"description": " ","title":" ","filename":"'.$single_big_image['id'].$single_big_image['ext'].'","width":"'.$single_big_image['w'].'","height":"'.$single_big_image['h'].'"};'."\n";
    }
    
    for ($x=0; $x<count($large_images);$x++) {
        foreach ($large_images_array as $single_large_image) {
        	if ($single_large_image['id'] == $large_images[$x]) {
	            $new_large_images_array[] = $single_large_image;
            	break;
            }
        }
        
        echo 'screenshots_large_data['.$x.'] = {"description": " ","title":" ","filename":"'.$single_large_image['id'].$single_large_image['ext'].'","width":"'.$single_large_image['w'].'","height":"'.$single_large_image['h'].'"};'."\n";
    }
    
	echo "</script>";    
   
?>

	<div class="main_container pictures_block" id="tab_main_article_0">   
            <ul class="picture_list">
                <?php		
                    $x=0;
                    for ($x = 0; $x < count($small_images); $x++) {
                    	$small_image = safe_row('*', 'txp_image', "id = '".$small_images[$x]."'");
                        echo '<li>';
                        print_png_image($imgdir.$small_image['id'].$small_image['ext'],null,null,array("alt"=>$small_image['alt'],"onclick"=>"setScreenshot('$x'); return false;","class"=>"action_image"));
						echo '<img src="'.link_to_home(array()).'images/shadow.png" alt="shadow" class="button_shadow"/>';
                        echo '</li>';
                    }
                
                ?>
            </ul>
            
		<div class="left_column">
        	<div id="screenshot_caption">		
                <?php		
				if ($current_article = safe_row('*', 'textpattern', "url_title = '".$GLOBALS['current_category']."'")){
                    echo "<h3>".$current_article['Title']."</h3>";
                    echo $current_article['Body_html'];
				}
                ?>
			</div>

		</div>
		
		<div class="screenshot_image">
		<?php
			print_png_image($imgdir.$new_big_images_array[0]['id'].$new_big_images_array[0]['ext'],null,null,array("alt"=>$new_big_images_array[0]['alt'],"id"=>"screenshot_image", "onclick"=>"showLargePicture()"));
		?>
		</div>
		
		<div class="clear"></div>
	</div>
    
    
    <!--[if lte IE 6]>
	<script type="text/javascript" charset="utf-8">
        var ziki_elements = Element.getElementsByClassName('document','action_image');
              
        for (x = 0; x<ziki_elements.length; x++) {
            ziki_elements[x].observe(
                'mouseover',
                function (event) {
                    var single_ziki = $(Event.element(event)).addClassName('action_image_hover');
                }
            );
            
            ziki_elements[x].observe(
                'mouseout',
                function (event) {
                    var single_ziki = $(Event.element(event)).removeClassName('action_image_hover');
                }
            );
        }
    </script>
<![endif]-->