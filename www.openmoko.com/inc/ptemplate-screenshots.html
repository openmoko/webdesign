<?php

	$scrimages = safe_rows('*', 'txp_image', "category = '".$GLOBALS['current_category']."'");
	global $prefs;
	$imgdir = link_to_home(array()).$prefs['img_dir'].'/';
    
      
	echo "<script>";
	echo "var images_gallery = false;";
    
    if (((strpos($_SERVER['HTTP_USER_AGENT'],"MSIE")) and (strpos($_SERVER['HTTP_USER_AGENT'],"MSIE 7")===false))) {
	    echo "var png_fix = true;\n";
    } else {
	    echo "var png_fix = false;\n";
    }

    echo "var images_dir = '".$imgdir."';";
    for ($x=0; $x<count($scrimages);$x++) {
    	$description = nl2br(var_export($scrimages[$x]['caption'],true));
        $description = str_replace("\r","",$description);
        $description = str_replace("\n","",$description);
        
		echo "screenshots_data[".$x."] = {'description':".$description.",'title':'".$scrimages[$x]['alt']."','filename':'".$scrimages[$x]['id'].$scrimages[$x]['ext']."','width':'".$scrimages[$x]['w']."','height':'".$scrimages[$x]['h']."'};";
    }
	echo "</script>";    
	
?>

<div class="screenshots_page">
	<div class="title_container">
		<h2>Screenshots</h2>
	</div>

	<div id="screenshot_caption">
<?php
	echo "<h3>".$scrimages[0]['alt']."</h3>";
    echo $scrimages[0]['caption'];
?>
	</div>
	
	<div class="screenshots_right">
		<div class="screenshot_image">
		<?php
                print_png_image($imgdir.$scrimages[0]['id'].$scrimages[0]['ext'],null,null,array("alt"=>$scrimages[0]['alt'],"id"=>"screenshot_image"));
		?>
		</div>
		
		<div class="screenshot_thumbs">
		
<?php		
	$x=0;
	foreach ($scrimages as $screenshot) {
    
		echo '<div class="screenshot_thumb" onclick="setScreenshot('.$x.'); return false;">';
		echo '<img src="'.$imgdir.$screenshot['id'].'t'.$screenshot['ext'].'" alt="'.$screenshot['alt'].'" />';
		echo '</div>';
        
        $x++;
	}

?>
		</div>
		
		<div class="clear"></div>
	</div>
	
	<div class="clear" style="height: 10px;"></div>
</div>

<!--[if lte IE 6]>
	<script type="text/javascript" charset="utf-8">
        var ziki_elements = Element.getElementsByClassName('document','screenshot_thumb');
              
        for (x = 0; x<ziki_elements.length; x++) {
            ziki_elements[x].observe(
                'mouseover',
                function (event) {
                    var single_ziki = $(Event.element(event)).up('.screenshot_thumb').addClassName('screenshot_thumb_hover');
                }
            );
            
            ziki_elements[x].observe(
                'mouseout',
                function (event) {
                    var single_ziki = $(Event.element(event)).up('.screenshot_thumb').removeClassName('screenshot_thumb_hover');
                }
            );
        }
    </script>
<![endif]-->